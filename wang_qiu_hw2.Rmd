---
title: "ESM 204 Assignment 2"
subtitle: "Simulating a Carbon Market"
author: "Ruoyu Wang, Siya Qiu"
date: "4/22/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

library(tidyverse)
library(janitor)
library(patchwork)
library(stargazer)
```

```{r data}
sectors <- read_csv("HW2_Data.csv") %>% 
  janitor::clean_names()
```

- Current carbon emissions in the sectors are: (A=170, B=200, C=230, and D=300).
- Sectors A, B, and C are in country X. Sector D is in a different country, Y.
- Prices are in $/ton and quantities are in tons.

```{r plot}

pa <- ggplot(data = sectors)+
  geom_point(aes(x = abatement, y = mc_a), color = "red")+
  labs(title = "Sector A", x = "Abatement (tons)", y = "Marginal abatement costs ($/ton)")+
  theme_minimal()

pb <- ggplot(data = sectors)+
  geom_point(aes(x = abatement, y = mc_b), color = "blue")+
  labs(title = "Sector B", x = "Abatement (tons)", y = "Marginal abatement costs ($/ton)")+
  theme_minimal()

pc <- ggplot(data = sectors)+
  geom_point(aes(x = abatement, y = mc_c), color = "pink")+
  labs(title = "Sector C", x = "Abatement (tons)", y = "Marginal abatement costs ($/ton)")+
  theme_minimal()

pd <- ggplot(data = sectors)+
  geom_point(aes(x = abatement, y = mc_d), color = "orange")+
  labs(title = "Sector D", x = "Abatement (tons)", y = "Marginal abatement costs ($/ton)")+
  theme_minimal()
  
(pa + pb) / (pc + pd)
```

model predict:
a: linear
b: linear 
c: linear start from x = 50
d: two linear?

```{r lma}
lma <- lm(mc_a ~ abatement, data = sectors)

lma
summary(lma)
```
```{r lmb}
lmb <- lm(mc_b ~ abatement, data = sectors)
lmb
summary(lmb)
```

```{r subC-lmc}
# make a subset of C
sec_c <- sectors %>% 
  select(abatement, mc_c) %>% 
  filter(mc_c > 0)

lmc <- lm(mc_c ~ abatement, data = sec_c)
lmc
summary(lmc)
```

```{r subD-lmd}
sec_d1 <- sectors %>% 
  filter(abatement < 40)

lmd1 <- lm(mc_d ~ abatement, data = sec_d1)

sec_d2 <-  sectors %>% 
  filter(abatement > 40)

lmd2 <- lm(mc_d ~ abatement, data = sec_d2)

lmd1
summary(lmd1)
lmd2
summary(lmd2)
```

summary:MC
- A: P = 1.663 + 0.513 * Q    0.7725
- B: P = 8.785 + 0.392 * Q   0.7102
- C: 0<Q<50, P = 0
  Q >= 50, P = -54.282 + 1.386 *Q   0.8794
- D: 0<Q<40, P = 0.830 + 0.108 * Q  0.2804 
  Q>= 40, P = -36.5 + 0.773 * Q  0.8255

```{r dateframe}
pred1 <- read_csv("prediction1_rw.csv")
```


```{r mcplot}
ggplot(data = pred1)+
  geom_line(aes(x = abatement, y = a),color = "pink")+
  geom_line(aes(x = abatement, y = b), color = "blue")+
  geom_line(aes(x = abatement, y = c), color = "green")+
  geom_line(aes(x = abatement, y = d), color = "purple")+
  scale_y_continuous(limits = c(0,100))+
  theme_minimal()
```

